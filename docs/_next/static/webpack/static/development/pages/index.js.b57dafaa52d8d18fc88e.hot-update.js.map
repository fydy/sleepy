{"version":3,"file":"static/webpack/static/development/pages/index.js.b57dafaa52d8d18fc88e.hot-update.js","sources":["webpack:///./components/PostList.js"],"sourcesContent":["import React from \"react\";\nimport Link from \"next/link\";\nimport api from \"../api\";\nimport Loading from \"../components/Loading\";\nimport { images, post } from \"../sleepy.config\";\nimport { relative } from \"../utils\";\n\nconst PostLoad = () => {\n  return (\n    <div className=\"post-item\">\n      <div className=\"poster loading\" />\n      <div className=\"content\">\n        <div className=\"title loading\" />\n        <div className=\"excerpt\">\n          <p className=\"loading\" />\n          <p className=\"loading\" />\n          <p className=\"loading\" />\n          <p className=\"loading\" />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default class extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      loadState: false,\n      loadEnd: false,\n      page: 1,\n      loadText: \"加载更多\",\n      posts: []\n    };\n  }\n\n  componentDidMount() {\n    const { query } = this.props;\n    api\n      .byPage({\n        page: query.page || 1\n      })\n      .then(data => {\n        this.setState(() => ({\n          posts: data\n        }));\n      });\n  }\n\n  loadMore() {\n    if (this.state.loadState) {\n      return;\n    }\n\n    this.setState(() => ({\n      loadState: true,\n      loadText: \"加载中...\"\n    }));\n\n    api\n      .byPage({\n        page: this.state.page + 1\n      })\n      .then(data => {\n        this.setState(prevState => ({\n          loadEnd: data.length < post.pageSize,\n          page: prevState.page,\n          posts: [...prevState.posts, ...data]\n        }));\n      });\n  }\n\n  render() {\n    const { posts, loadText, loadEnd } = this.state;\n    if (posts.length) {\n      return (\n        <div className=\"post-list\">\n          <PostLoad />\n          <PostLoad />\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"post-list\">\n        {posts.map(item => (\n          <div key={item.id} className=\"post-item\">\n            <Link href={`post/?id=${item.id}`}>\n              <a>\n                <div\n                  className=\"poster\"\n                  style={{\n                    backgroundImage: `url(${item.poster ||\n                      images.poster ||\n                      \"/static/poster.png\"})`\n                  }}\n                />\n              </a>\n            </Link>\n            <div className=\"content\">\n              <Link href={`post/?id=${item.id}`}>\n                <a className=\"title\">{item.title}</a>\n              </Link>\n              <div className=\"excerpt\">{item.excerpt}</div>\n            </div>\n            <div className=\"time\">{relative(item.created_at)}</div>\n            <div className=\"tags\">\n              {item.tags.map(tag => (\n                <Link key={tag} href={`archive/?tag=${tag}`}>\n                  <a className=\"tag\">#{tag}</a>\n                </Link>\n              ))}\n            </div>\n          </div>\n        ))}\n\n        {loadEnd ? (\n          <div className=\"loadEnd\">加载完毕</div>\n        ) : (\n          <div className=\"loadMore\" onClick={this.loadMore.bind(this)}>\n            {loadText}\n          </div>\n        )}\n      </div>\n    );\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AACA;;;;;;AAEA;AAAA;AACA;AADA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AAFA;AASA;AACA;;;AACA;AAAA;AACA;AADA;AAEA;AAEA;AADA;AAIA;AAAA;AACA;AADA;AAAA;AAGA;AACA;;;AAEA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAFA;AAAA;AAKA;AAEA;AADA;AAIA;AAAA;AACA;AACA;AACA;AAHA;AAAA;AAKA;AACA;;;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AADA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAFA;AAtBA;AAgCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;;;;AArGA;AACA;;;;;A","sourceRoot":""}