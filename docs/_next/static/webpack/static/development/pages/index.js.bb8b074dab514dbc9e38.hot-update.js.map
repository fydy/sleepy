{"version":3,"file":"static/webpack/static/development/pages/index.js.bb8b074dab514dbc9e38.hot-update.js","sources":["webpack:///./components/PostList.js"],"sourcesContent":["import React from \"react\";\nimport Link from \"next/link\";\nimport api from \"../api\";\nimport { images, post } from \"../sleepy.config\";\nimport { relative, t } from \"../utils\";\nimport PostLoad from \"../components/PostLoad\";\n\nexport default class extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      loadState: false,\n      loadEnd: false,\n      page: 1,\n      loadText: t('loadMore'),\n      posts: []\n    };\n  }\n\n  componentDidMount() {\n    api\n      .byPage({\n        page: this.state.page\n      })\n      .then(data => {\n        this.setState(() => ({\n          posts: data\n        }));\n      });\n  }\n\n  loadMore() {\n    if (this.state.loadState) {\n      return;\n    }\n\n    this.setState(() => ({\n      loadState: true,\n      loadText: t('loading')\n    }));\n\n    api\n      .byPage({\n        page: this.state.page + 1\n      })\n      .then(data => {\n        this.setState(prevState => ({\n          loadState: false,\n          loadText: t('loadMore'),\n          loadEnd: data.length < post.pageSize,\n          page: prevState.page,\n          posts: [...prevState.posts, ...data]\n        }));\n      });\n  }\n\n  render() {\n    const { posts, loadText, loadEnd } = this.state;\n    if (!posts.length) {\n      return (\n        <div className=\"post-list\">\n          <PostLoad />\n          <PostLoad />\n          <PostLoad />\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"post-list\">\n        {posts.map(item => (\n          <div key={item.id} className=\"post-item\">\n            <Link href={`post?id=${item.id}`}>\n              <a>\n                <div\n                  className=\"poster\"\n                  style={{\n                    backgroundImage: `url(${item.poster ||\n                      images.poster ||\n                      \"/static/poster.png\"})`\n                  }}\n                />\n              </a>\n            </Link>\n            <div className=\"content\">\n              <Link href={`post?id=${item.id}`}>\n                <a className=\"title\">{item.title}</a>\n              </Link>\n              <div className=\"excerpt\">{item.excerpt}</div>\n            </div>\n            <div className=\"time\" title={item.created_at}>{relative(item.created_at)}</div>\n            <div className=\"tags\">\n              {item.tags.map(tag => <span className=\"tag\">#{tag}</span>)}\n            </div>\n          </div>\n        ))}\n\n        {loadEnd ? (\n          <div className=\"loadEnd\">{t('loadEnd')}</div>\n        ) : (\n          <div className=\"loadMore\" onClick={this.loadMore.bind(this)}>\n            {loadText}\n          </div>\n        )}\n      </div>\n    );\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;AAEA;AAAA;AACA;AADA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AAFA;AASA;AACA;;;AACA;AAAA;AACA;AAAA;AAEA;AADA;AAIA;AAAA;AACA;AADA;AAAA;AAGA;AACA;;;AAEA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAFA;AAAA;AAKA;AAEA;AADA;AAIA;AAAA;AACA;AACA;AACA;AACA;AACA;AALA;AAAA;AAOA;AACA;;;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AADA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAtBA;AA4BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;;;;AAnGA;AACA;;;;;A","sourceRoot":""}